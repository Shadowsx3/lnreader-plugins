var t=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(a,i){function c(t){try{s(n.next(t))}catch(t){i(t)}}function o(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?a(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(c,o)}s((n=n.apply(t,e||[])).next())}))},e=this&&this.__generator||function(t,e){var r,n,a,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},c=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return c.next=o(0),c.throw=o(1),c.return=o(2),"function"==typeof Symbol&&(c[Symbol.iterator]=function(){return this}),c;function o(o){return function(s){return function(o){if(r)throw new TypeError("Generator is already executing.");for(;c&&(c=0,o[0]&&(i=0)),i;)try{if(r=1,n&&(a=2&o[0]?n.return:o[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,o[1])).done)return a;switch(n=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,n=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=e.call(t,i)}catch(t){o=[6,t],n=0}finally{r=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),n=require("cheerio"),a=function(){function a(){this.id="novelasligeras.net",this.name="NOVA",this.icon="src/es/nova/icon.png",this.site="https://novelasligeras.net",this.version="1.0.1",this.searchAjax="/wp-admin/admin-ajax.php?tags=1&sku=&limit=30&category_results=&order=DESC&category_limit=5&order_by=title&product_thumbnails=1&title=1&excerpt=1&content=&categories=1&attributes=1",this.checkCaptcha=function(t){var e=t("title").text();if("Attention Required! | Cloudflare"===e||"Just a moment..."===e)throw new Error("Captcha error, please open in webview")}}return a.prototype.popularNovels=function(){return t(this,arguments,void 0,(function(t){return void 0===t&&(t=1),e(this,(function(e){return[2,this.searchNovels("",t)]}))}))},a.prototype.searchNovels=function(a){return t(this,arguments,void 0,(function(t,a){var i,c,o,s,u,l,p,h=this;return void 0===a&&(a=1),e(this,(function(e){switch(e.label){case 0:return a<=1?(i=this.site+this.searchAjax,(c=new FormData).append("action","product_search"),c.append("product-search",String(a)),c.append("product-query",t),[4,(0,r.fetchApi)(i,{method:"POST",body:c})]):[3,3];case 1:return[4,e.sent().text()];case 2:return o=e.sent(),[2,JSON.parse(o).map((function(t){return{name:t.title,cover:t.thumbnail,path:t.url.replace(h.site,"")}}))];case 3:return s="".concat(this.site,"/index.php/page/").concat(a,"/?s=").concat(encodeURIComponent(t),"&post_type=product&title=1&excerpt=1&content=0&categories=1&attributes=1&tags=1&sku=0&orderby=popularity&ixwps=1"),[4,(0,r.fetchApi)(s)];case 4:return[4,e.sent().text()];case 5:return u=e.sent(),l=(0,n.load)(u),this.checkCaptcha(l),p=[],l(".dt-css-grid").find("div.wf-cell").each((function(t,e){var r=l(e),n=r.find("h4.entry-title a"),a=r.find("img"),i=(n.attr("href")||"").replace(h.site,""),c=a.attr("data-src")||a.attr("data-cfsrc")||a.attr("src")||"";p.push({name:n.text().trim(),cover:c,path:i})})),[2,p]}}))}))},a.prototype.parseNovel=function(a){return t(this,void 0,void 0,(function(){var t,i,c,o,s,u,l,p=this;return e(this,(function(e){switch(e.label){case 0:return t=this.site+a,[4,(0,r.fetchApi)(t)];case 1:return[4,e.sent().text()];case 2:return i=e.sent(),c=(0,n.load)(i),this.checkCaptcha(c),o={path:a,name:c("h1").first().text().trim()||"Untitled"},s=c(".woocommerce-product-gallery").find("img"),o.cover=s.attr("src")||s.attr("data-cfsrc")||s.attr("data-src")||"",o.author=c(".woocommerce-product-attributes-item--attribute_pa_escritor td").text().trim(),o.artist=c(".woocommerce-product-attributes-item--attribute_pa_ilustrador td").text().trim(),o.status=c(".woocommerce-product-attributes-item--attribute_pa_estado td").text().trim(),u=c(".woocommerce-product-details__short-description").html()||"",o.summary=(0,n.load)(u).text().trim(),l=[],c(".vc_row div.vc_column-inner > div.wpb_wrapper").each((function(t,e){var r=c(e),n=r.find(".dt-fancy-title").first().text().trim();/^Volumen/i.test(n)&&r.find(".wpb_tab a").each((function(t,e){var r=c(e),a=r.text().trim(),i=(r.attr("href")||"").replace(p.site,""),o=a.match(/(Parte \d+)\s*.\s*(.+?):\s*(.+)/i),s=null==o?void 0:o[1],u=null==o?void 0:o[2],h=null==o?void 0:o[3],d=s&&u?"".concat(n," - ").concat(u," - ").concat(s,": ").concat(h):"".concat(n," - ").concat(a);l.push({name:d,path:i})}))})),o.chapters=l,[2,o]}}))}))},a.prototype.parseChapter=function(a){return t(this,void 0,void 0,(function(){var t,i,c,o;return e(this,(function(e){switch(e.label){case 0:return t=this.site+a,[4,(0,r.fetchApi)(t)];case 1:return[4,e.sent().text()];case 2:return i=e.sent(),c=(0,n.load)(i),this.checkCaptcha(c),(o=i.includes("Nadie entra sin permiso en la Gran Tumba de Nazarick")?c("#content"):c(".wpb_text_column.wpb_content_element > .wpb_wrapper")).find("center").each((function(t,e){c(e).remove()})),o.find("*").each((function(t,e){var r=(c(e).attr("style")||"").toLowerCase();if(r.includes("text-align")&&r.includes("center")){var n=c(e).html()||"";c(e).replaceWith("<center>".concat(n,"</center>"))}})),[2,o.html()||""]}}))}))},a}();exports.default=new a;